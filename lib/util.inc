<?php
//====================================================================================================
//  システム名：
//      書籍管理システム(Web版Ver.2.5)
//  サブシステム名：
//      共通機能
//  モジュール名：
//      util.inc
//  説明：
//      共通関数群
//  バージョン情報：
//      作成日）2010/03/29
//      作成者）神田ITスクール
//      変更日）2015/07/24
//      変更者）水島創太
//  備考
//====================================================================================================

//====================================================================================================
//  概要：
//    createSqlString
//  機能説明：
//    指定された文字列の両端にシングルクォートを追加。
//    文字列中にシングルクォートが有る場合、シングルクォート2つに置換。
//  引数：
//    $str：対象文字列
//  戻り値
//    変更後文字列
//  備考：
//    作成日）2010/03/29
//    作成者）神田ITスクール
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================
//指定された文字列の両端にシングルクォートを追加。
//文字列中にシングルクォートが有る場合、シングルクォート2つに置換。
function createSqlString($str) {
	$str = str_replace("'" , "''" , $str);
	return "'" . $str . "'";
}

//====================================================================================================
//  概要：
//    createNullHtmlString
//  機能説明：
//    $valueがNullの時、$valueに'null'をセット
//  引数：
//    $value ：指定の値
//  戻り値
//    文字列
//  備考：
//    作成日）2010/03/29
//    作成者）神田ITスクール
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================
function createNullHtmlString($value){
	if(strlen($value) ==0){
		return " ";
	}
	return $value;
}

//====================================================================================================
//  概要：
//    getFirstStr
//  機能説明：
//    $strの最初の一文字を取得
//  引数：
//    $str：文章
//  戻り値
//    文字列
//  備考：
//    作成日）2015/08/31
//    作成者）水島創太
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================

function getFirstStr($str){
	if($str != "")
	{
		return mb_substr( $str, 0, 1, "UTF-8" );
	}else{
		return $str;
	}

}

	//====================================================================================================
	//  概要：
	//    creatDateFormat
	//  機能説明：
	//    引数の文字列$strの"-"を"/"に変換して返す。
	//  引数：
	//    $str ：文字列
	//  戻り値
	//    文字列
	//  備考：
	//    作成日）2015/07/24
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function createDateFormat($str)
		{
			if($str != ""){
				return str_replace("-","/",$str);
			}

		}

	//====================================================================================================
	//  概要：
	//    creatTimeFormat
	//  機能説明：
	//    引数の時間を所定のフォーマットに変換して返す。
	//  引数：
	//    $time
	//  戻り値
	//    文字列
	//  備考：
	//    作成日）2015/08/24
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================



		function createTimeFormat($time)
		{
			if($time != ""){
				return date('H',strtotime($time));
			}
		}

	//====================================================================================================
	//  概要：
	//    creatDate
	//  機能説明：
	//    引数の年,月,日を日付情報にして返す
	//  引数：
	//    $year,$month,$day
	//  戻り値
	//    $date(日付情報)
	//  備考：
	//    作成日）2015/09/14
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function createDate($year,$month,$day)
		{
			//引数の年、月,日を変換
			$date =  "{$year}-{$month}-{$day}";

			//変換した日付情報を返す
			return $date;
		}

	//====================================================================================================
	//  概要：
	//    creatDate
	//  機能説明：
	//    引数の$selectに入力された端子を元にそれに見合った日付を返す。
	//    どの端子とも一致しない場合、falseを返却する。
	//	  (y="年",m="月",d="日")
	//  引数：
	//    $year,$month,$day
	//  戻り値
	//    $date(日付情報)
	//  備考：
	//    作成日）2015/09/28
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function createDateYMD($date,$select)
		{
			//端子によって返却する値を変更する
			switch($select){

				case y:
					return date('Y',strtotime($date));
					break;
				case m:
					return date('m',strtotime($date));
					break;
				case d:
					return date('d',strtotime($date));
					break;
				default:
					return false;
					break;

			}
		}

	//====================================================================================================
	//  概要：
	//    creatHour
	//  機能説明：
	//    引数の時間を所定のフォーマットに変換して返す。
	//  引数：
	//    $time
	//  戻り値
	//    文字列
	//  備考：
	//    作成日）2015/09/01
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function createHour($time)
		{
			if($time != ""){
				//時間のみの表示で返す。
				return date('G',strtotime($time));
			}
		}

	//====================================================================================================
	//  概要：
	//    creatMinute
	//  機能説明：
	//    引数の時間を所定のフォーマットに変換して返す。
	//  引数：
	//    $time
	//  戻り値
	//    文字列
	//  備考：
	//    作成日）2015/09/01
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function createMinute($time)
		{
			if($time != ""){
				//分のみの表示で返す。
				return date('i',strtotime($time));
			}
		}

	//====================================================================================================
	//  概要：
	//    changeOfSecond
	//  機能説明：
	//    引数の時間と分を元に秒数にして返す
	//  引数：
	//    $hour,$minute
	//  戻り値
	//    $second
	//  備考：
	//    作成日）2015/09/03
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function changeOfSecond($hour,$minute)
		{
			$second = $hour * 3600 + $minute * 60 + 0;

			return $second;
		}

	//====================================================================================================
	//  概要：
	//    changeOfSecondByTime
	//  機能説明：
	//    引数の時間と分を元に秒数にして返す
	//  引数：
	//    $time
	//  戻り値
	//    $second
	//  備考：
	//    作成日）2015/09/03
	//    作成者）水島創太
	//    説  明）
	//    更新日）
	//    更新者）
	//    変  更）
	//====================================================================================================

		function changeOfSecondByTime($time)
		{

			$hour = createHour($time);
			$minute = createMinute($time);

			$second = $hour * 3600 + $minute * 60 + 0;

			return $second;
		}


	/*====================================================================================
	 *概要：
	 *	checkOfTimeError()
	 *機能説明：
	 *
	 *	休憩時間が正規のものであるかどうかを判定し、エラーがあれば
	 *	エラーメッセージにメッセージを格納し、falseを返す。
	 *	エラーがなければtrueを返却する。
	 *
	 *引数：
	 *	$startTime,$endTime
	 *戻り値：
	 *	なし
	 *備考：
	 *	作成日)	2015/9/03
	 *	作成者)	水島創太
	 *	説明）
	 *	更新日)
	 *	更新者)
	 *	変更)
	  ====================================================================================
	 */

		function checkOfTimeError($startTime,$endTime)
		{
			//endTimeとstartTimeを比較する
			if($startTime >= $endTime)
			{

				$tf = false;

			}else{

				$tf = true;

			}

			return $tf;
		}

	/*====================================================================================
	 *概要：
	 *	checkMonthPeriod
	 *機能説明：
	 *
	 *	スタートした期間の月と終わる月まで何ヶ月あるかを計算して返す。
	 *
	 *引数：
	 *	$startMonth(開始月),$endMonth（終了月）
	 *戻り値：
	 *	なし
	 *備考：
	 *	作成日)	2015/9/14
	 *	作成者)	水島創太
	 *	説明）
	 *	更新日)
	 *	更新者)
	 *	変更)
	  ====================================================================================
	 */

		function checkMonthPeriod($startMonth,$endMonth)
		{
			$start = date("n",strtotime($startMonth));
			$end   = date("n",strtotime($endMonth));

			$period = ($end - $start) + 1;

			return $period;
		}


	/*====================================================================================
	 *概要：
	 *	checkDayOfWeek()
	 *機能説明：
	 *
	 *		日付番号に該当する曜日名称をそのまま返す
	 *
	 *引数：
	 *	$DayOfWeek
	 *戻り値：
	 *	なし
	 *備考：
	 *	作成日)	2015/9/03
	 *	作成者)	水島創太
	 *	説明）
	 *	更新日)
	 *	更新者)
	 *	変更)
	  ====================================================================================
	 */

		function checkDayOfWeek($D_of_W)
		{
			//一般休憩開始時間が一般休憩終了時間より遅かった場合,次の処理に進む。


			//曜日を判定
			switch($D_of_W)
			{
				case 1:
					$dayOfWeek = "月曜日";
					break;
				case 2:
					$dayOfWeek = "火曜日";
					break;
				case 3:
					$dayOfWeek = "水曜日";
					break;
				case 4:
					$dayOfWeek = "木曜日";
					break;
				case 5:
					$dayOfWeek = "金曜日";
					break;
				case 6:
					$dayOfWeek = "月曜日";
					break;
				default:
					$dayOfWeek = "日曜日";
					break;
			}

			return $dayOfWeek;
		}


//====================================================================================================
//  概要：
//   excludeZero
//  機能説明：
//   引数の文字列の先頭から0を除外して返却する。
//  引数：
//    $str ：文字列
//  戻り値
//    $num
//  備考：
//    作成日）2015/09/04
//    作成者)水島創太
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================

function excludeZero($str)
{
	$num = ltrim($str, '0');

	return $num;
}

//====================================================================================================
//  概要：
//   createYearSet
//  機能説明：
//   今年から過去10年ぶんずつの年次を格納し、降順に並び替えて
//   返却する。
//  引数：
//
//  戻り値
//    $yearList
//  備考：
//    作成日）2015/09/08
//    作成者)水島創太
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================

function createYearSet()
{
	$yearList = "";
	$year = date("Y");

	//5年分ループをまわす。
	for($i=1;$i<=10;$i++){

		//$i年分先のデータを格納する。
		$yearList[] = date("Y", strtotime("-{$i} year"));

	}

	return $yearList;
}

//====================================================================================================
//  概要：
//   createDayOfWeek
//  機能説明：
//   日付を引数に対応する曜日を番号で返す。
//  引数：
//		$date(日付)
//  戻り値
//    $w(曜日番号)
//  備考：
//    作成日）2015/09/08
//    作成者)水島創太
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================


function createDayOfWeek($date){

			$datetime = new DateTime($date);
			$w = (int)$datetime->format('w');
			return $w;

}
/*====================================================================================
 *概要：
 *	getWeekOfDay
 *機能説明：
 *	週次検索で指定した週の曜日の日付を取得する。
 *引数：
 *	年月($yearMonth),第何週($week),日($day)
 *戻り値：
 *	日付
 *備考：
 *	作成日)	2015/9/8
 *	作成者)	鈴木一紘
 *	説明）
 *	更新日)
 *	更新者)
 *	変更)
 ====================================================================================
 */

function getWeekOfDay($yearMonth, $week, $day) {
	// 1・指定した年月の最初の曜日を取得
	$firstDay = date("w", strtotime($yearMonth.'-1'));

	// 2・求めたい曜日の第1週の日付けを計算する
	$day = $day - $firstDay + 1;
	if($day <= 0) $day += 7;

	// 3・n週まで1週間を足す
	$day += 7 * ($week - 1);

	// 4・結果を返す
	return date("Y-m-d", strtotime($yearMonth.'-'.$day));
}

//====================================================================================================
//  概要：
//    createMoneyFormat
//  機能説明：
//    数値を「\」記号付3桁「,」区切りの金額フォーマットに変換する
//  引数：
//    $value ：指定の値
//  戻り値
//    文字列
//  備考：
//    作成日）2010/03/29
//    作成者）神田ITスクール
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================
function createMoneyFormat($value){

	$value = "\\".number_format($value);
	return $value;
}

//====================================================================================================
//  概要：
//    callErrorPage
//  機能説明：
//    エラー頁へ遷移する関数
//  引数：
//    $errMsg ：エラーメッセージ $path :エラーページリンク制御
//  戻り値
//    無し
//  備考：
//    作成日）2010/03/29
//    作成者）神田ITスクール
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================
function callErrorPage($errMsg,$path){
	//エラー画面へ遷移する
	header("location: ../error/error.php?errMsg=".urlencode($errMsg)."&path=".urlencode($path));

}

//====================================================================================================
//  概要：
//    mailTransmit
//  機能説明：
//    メールを送信する。
//  引数：
//    $to ：宛先  $sbj :件名  $msg :本文
//  戻り値
//    無し
//  備考：
//    作成日）2015/7/15
//    作成者）水島創太
//    説  明）
//    更新日）
//    更新者）
//    変  更）
//====================================================================================================

function mailTransmit ($to,$sbj,$msg){

	//件名とハンドラを設定。
	$from= "From:" ."神田ITスクール"."<bbb@bbb.com>";
	$hdr = "Content-Type: text/plain;charset=ISO-2022-JP";

	//コンバートの言語を日本語に設定
	mb_language("ja");

	//件名と本文をエンコード
	$sbj = mb_convert_encoding($sbj,"JIS","UTF-8");
	$msg = mb_convert_encoding($msg,"JIS","UTF-8");

	if(@mb_send_mail($to,$sbj,$msg,$from,$hdr)){
		return "";
	}else{
		return "購入情報は送信できませんでした。\n";
	}

}



